<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ProductMapper">

	<!-- default DTO S -->

	<resultMap type="com.basic.product.ProductSelectDTO" id="ProductSelect">
		<id column="productSelect_num" property="productSelect_num"
			javaType="int" />
		<result column="productSelect_name" property="productSelect_name"
			javaType="java.lang.String" />
	</resultMap>

	<resultMap type="com.basic.product.KindDTO" id="Kind">
		<id column="kind_num" property="kind_num" javaType="int" />
		<result column="kind_name" property="kind_name" javaType="java.lang.String" />
	</resultMap>

	<resultMap type="com.basic.product.ProductInfoDTO" id="ProductInfo">
		<id column="product_num" property="product_num" javaType="int" />
		<result column="productInfo_price" property="productInfo_price"
			javaType="int" />
		<result column="productInfo_reg_date" property="productInfo_reg_date"
			javaType="java.sql.Date" />
		<result column="productInfo_rec_date" property="productInfo_rec_date"
			javaType="java.sql.Date" />
		<result column="productInfo_saleRate" property="productInfo_saleRate"
			javaType="double" />
		<result column="productInfo_searchWord" property="productInfo_searchWord"
			javaType="java.lang.String" />
	</resultMap>

	<resultMap type="com.basic.product.ProductEachDTO" id="ProductEach">
		<id column="product_num" property="product_num" javaType="int" />
		<result column="productEach_size" property="productEach_size"
			javaType="java.lang.String" />
		<result column="productEach_color" property="productEach_color"
			javaType="java.lang.String" />
		<result column="productEach_each" property="productEach_each"
			javaType="int" />
	</resultMap>

	<resultMap type="com.basic.product.ProductKindDTO" id="ProductKind">
		<result column="product_num" property="product_num" javaType="int" />
		<result column="kind_num" property="kind_num" javaType="int" />
	</resultMap>

	<resultMap type="com.basic.product.ProductPicDTO" id="ProductPic">
		<id column="product_num" property="product_num" javaType="int" />
		<result column="productPic_pic" property="ProductPic_pic"
			javaType="java.lang.String" />
	</resultMap>

	<resultMap type="com.basic.product.ProductDTO" id="Product">
		<id column="product_num" property="product_num" javaType="int" />
		<result column="product_name" property="product_name" javaType="java.lang.String" />
	</resultMap>

	<!-- PRODUCTVIEW DTO S -->
	<resultMap type="com.basic.product.ProductViewDTO" id="ProudctView">
		<id column="product_num" property="product_num" javaType="int" />
		<result column="product_name" property="product_name" javaType="java.lang.String" />
		<result column="productInfo_price" property="productInfo_price"
			javaType="int" />
		<result column="productInfo_saleRate" property="productInfo_saleRate"
			javaType="double" />
		<result column="productInfo_searchWord" property="productInfo_searchWord"
			javaType="java.lang.String" />
		<result column="kind_num" property="kind_num" javaType="int" />

		<collection property="productEachDTOs" ofType="com.basic.product.ProductEachDTO">
			<result column="productEach_size" property="productEach_size"
				javaType="java.lang.String" />
			<result column="productEach_color" property="productEach_color"
				javaType="java.lang.String" />
			<result column="productEach_each" property="productEach_each"
				javaType="int" />
		</collection>

	</resultMap>

	<!-- PRODUCTVIEW DTO E -->

	<!-- default DTO E -->

	<!-- join DTO S -->





	<!-- Product List DTO S -->

	<!-- Product List DTO E -->

	<!-- Product List S -->
	<select id="SelProductList" resultType="com.basic.product.ProductListDTO"
		parameterType="java.util.HashMap">
		select * from
		(select ROWNUM r,t.* from (select DISTINCT
		p.PRODUCT_NUM,p.PRODUCT_NAME,pi.PRODUCTINFO_PRICE from PRODUCT p ,
		PRODUCTINFO pi , PRODUCTEACH pe , PRODUCTKIND pk
		where pe.PRODUCT_NUM =
		p.PRODUCT_NUM
		and pi.PRODUCT_NUM = p.PRODUCT_NUM
		and pk.PRODUCT_NUM =
		p.PRODUCT_NUM
		<if test="productParamDTO.color != null ">
			and UPPER(pe.PRODUCTEACH_COLOR) in
			<foreach item="item" index="index" collection="productParamDTO.color"
				open="(" separator="," close=")">
				UPPER(#{item})
			</foreach>
		</if>
		<if test="productParamDTO.kind_num != null ">
			and UPPER(pk.kind_num) in
			<foreach item="item" index="index" collection="productParamDTO.kind_num"
				open="(" separator="," close=")">
				UPPER(#{item})
			</foreach>
		</if>
		<if test="productParamDTO.size != null ">
			and UPPER(pe.PRODUCTEACH_size) in
			<foreach item="item" index="index" collection="productParamDTO.size"
				open="(" separator="," close=")">
				UPPER(#{item})
			</foreach>
		</if>
		<choose>
			<when test="productParamDTO.sel == 2">
				order by p.PRODUCT_NUM asc
			</when>
			<when test="productParamDTO.sel == 3">
				order by pi.productInfo_price asc
			</when>
			<when test="productParamDTO.sel == 4">
				order by pi.productInfo_price desc
			</when>
			<otherwise>
				order by p.PRODUCT_NUM desc
			</otherwise>
		</choose>
		) t ) where r BETWEEN
		#{pageMaker.startRowNum} and
		#{pageMaker.lastLowNum}

	</select>
	<!-- Product List E -->

	<!-- Product List Count S -->
	<select id="SelProductCount" parameterType="com.basic.product.ProductParamDTO"
		resultType="int">
		select count(t.product_num) from (select DISTINCT
		p.PRODUCT_NUM,p.PRODUCT_NAME,pi.PRODUCTINFO_PRICE from PRODUCT p ,
		PRODUCTINFO pi , PRODUCTEACH pe , PRODUCTKIND pk
		where pe.PRODUCT_NUM =
		p.PRODUCT_NUM
		and pi.PRODUCT_NUM = p.PRODUCT_NUM
		and pk.PRODUCT_NUM =
		p.PRODUCT_NUM
		<if test="color != null ">
			and UPPER(pe.PRODUCTEACH_COLOR) in
			<foreach item="item" index="index" collection="color" open="("
				separator="," close=")">
				UPPER(#{item})
			</foreach>
		</if>
		<if test="kind_num != null ">
			and UPPER(pk.kind_num) in
			<foreach item="item" index="index" collection="kind_num"
				open="(" separator="," close=")">
				UPPER(#{item})
			</foreach>
		</if>
		<if test="size != null ">
			and UPPER(pe.PRODUCTEACH_size) in
			<foreach item="item" index="index" collection="size" open="("
				separator="," close=")">
				UPPER(#{item})
			</foreach>
		</if>
		) t

	</select>
	<!-- Product List Count E -->

	<!-- Product View S -->
	<select id="SelProductView" parameterType="int" resultMap="ProudctView">
		SELECT
		p.PRODUCT_NUM,p.PRODUCT_NAME,pi.PRODUCTINFO_PRICE,pi.PRODUCTINFO_SALERATE,
		pi.productInfo_searchWord,
		pk.KIND_NUM,pe.PRODUCTEACH_COLOR,pe.PRODUCTEACH_EACH,pe.PRODUCTEACH_SIZE
		from PRODUCT p , PRODUCTINFO pi , PRODUCTKIND pk ,PRODUCTEACH pe
		where
		pe.PRODUCT_NUM = p.PRODUCT_NUM
		and pi.PRODUCT_NUM = p.PRODUCT_NUM
		and
		pk.PRODUCT_NUM = p.PRODUCT_NUM
		and p.PRODUCT_NUM = #{product_num}
	</select>
	<!-- Product View E -->
	
	<!--   Product Add S  -->
	
	<insert id="ProductAdd" parameterType="com.basic.product.ProductAddDTO">
	insert into product
		values(product_seq.nextval,#{product_name})
	</insert>
	<insert id="ProductInfoAdd" parameterType="com.basic.product.ProductAddDTO">
		insert into productInfo
		values(product_seq.currval,#{productInfo_price},sysdate,sysdate,#{productInfo_saleRate},#{productInfo_searchWord})
	</insert>
	<insert id="ProductKindAdd" parameterType="com.basic.product.ProductAddDTO">
		insert into productKind
		values(product_seq.currval,#{kind_num})
	</insert>
	
	<!--   Product Add E  -->
	
	<!--   Product Size Add S  -->
	
	<insert id="ProductSizeAdd" parameterType="com.basic.product.ProductEachAddDTO">
	insert into productSize
		values(#{product_num},#{productSize_size})
	</insert>
	<insert id="ProductEachAdd" parameterType="com.basic.product.ProductEachAddDTO">
		insert into productEach
		values(#{product_num},#{productSize_size},#{productEach_color},#{productEach_each})
	</insert>
	
	<!--   Product Size Add E  -->
	




</mapper>